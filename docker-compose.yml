version: "3.8"
services:
  backend:
    image: python:3.11-slim
    container_name: mock-backend
    ports:
      - "8080:8080"
    volumes:
      - ./mock_backend:/mock_backend
    command: ["sh","-c","pip install --no-cache-dir flask && python -u /mock_backend/server.py"]

  agent:
    build: .
    image: vunet-light-agent:latest
    container_name: vunet-agent
    ports:
      - "9001:9001"
    environment:
      - BACKEND_URL=http://backend:8080/api/metrics
      - SERVER_PORT=9001
    depends_on:
      - backend
    restart: always
    healthcheck:
      test: ["CMD","curl","-f","http://localhost:9001/health"]
      interval: 30s
      timeout: 5s
      retries: 3


